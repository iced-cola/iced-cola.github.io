<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="个人博客">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="/images/favicon.png">
    <link rel="alternate" type="application/atom+xml" title="Chenxii" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        SpringBoot基础学习笔记｜Chenxii&#39;s blog
        
    </title>

    <link rel="canonical" href="http://iced-cola.github.io/2019/01/01/SpringBoot基础学习笔记/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/blog-style.css">


    <!-- Pygments Github CSS -->
    
<link rel="stylesheet" href="/css/syntax.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<style>
    header.intro-header {
        background-image: url('/images/th.jpeg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Chenxii
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="/images/th.jpeg">


<style>
    
    header.intro-header {
        background-image: url('/images/th.jpeg')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>SpringBoot基础学习笔记</h1>
                    
                    <span class="meta">
                         作者 Chenxii
                        <span>
                          日期 2019-01-01
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#SpringBoot"
                           title="SpringBoot">SpringBoot</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            SpringBoot基础学习笔记
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <h2 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h2><ol>
<li>SpringBoot入门</li>
<li>SpringBoot配置</li>
<li>SpringBoot与日志</li>
<li>SpringBoot与Web开发</li>
<li>SpringBoot与Docker</li>
<li>SpringBoot与数据访问</li>
<li>SpringBoot启动配置原理</li>
<li>SpringBoot自定义Starters</li>
<li>SpringBoot与缓存</li>
<li>SpringBoot与消息</li>
<li>SpringBoot与检索</li>
<li>SpringBoot与任务</li>
<li>SpringBoot与安全</li>
<li>SpringBoot与分布式</li>
<li>SpringBoot与开发热部署</li>
<li>SpringBoot与监控管理</li>
</ol>
<h2 id="第一章-SpringBoot入门"><a href="#第一章-SpringBoot入门" class="headerlink" title="第一章 SpringBoot入门"></a>第一章 SpringBoot入门</h2><h3 id="1-1-SpringBoot简介"><a href="#1-1-SpringBoot简介" class="headerlink" title="1.1 SpringBoot简介"></a>1.1 SpringBoot简介</h3><p>特点：约定大于配置；去繁从简；</p>
<span id="more"></span>



<p>背景： </p>
<p>J2EE笨重的开发；</p>
<p>繁多的配置；</p>
<p>低下的效率；</p>
<p>复杂的部署；</p>
<p>第三方技术集成难度大；</p>
<p>解决方案：</p>
<p>SpringBoot：一站式J2EE的解决方案；</p>
<p>SpringCloud：分布式整体解决方案；</p>
<p>优点：</p>
<p>快速创建可独立运行的Spring项目并与主流框架集成；</p>
<p>starters自动依赖管理及版本控制；</p>
<p>使用嵌入的Servlet容器，应用无需打包；</p>
<p>大量的自动配置，简化开发，也可修改默认值；</p>
<p>无需配置XML，无代码生成，开箱即用；</p>
<p>准生产环境的运行时应用监控；</p>
<p>是对Spring技术栈的一个整合。</p>
<hr>
<h3 id="1-2-微服务"><a href="#1-2-微服务" class="headerlink" title="1.2 微服务"></a>1.2 微服务</h3><p>单体应用： 开发，测试，部署简单；</p>
<p>微服务：功能拆分，灵活配置，通信协作。</p>
<p>SpringBoot官网 &gt; 微服务文档</p>
<hr>
<h3 id="1-3-开发环境配置"><a href="#1-3-开发环境配置" class="headerlink" title="1.3 开发环境配置"></a>1.3 开发环境配置</h3><ol>
<li>JDK版本；</li>
<li>maven版本；</li>
<li>开发工具选择；</li>
<li>框架版本选择；</li>
</ol>
<hr>
<h3 id="1-4-第一个应用：HelloWorld"><a href="#1-4-第一个应用：HelloWorld" class="headerlink" title="1.4 第一个应用：HelloWorld"></a>1.4 第一个应用：HelloWorld</h3><ol>
<li>创建一个Maven项目；</li>
<li>导入SpringBoot相关依赖；</li>
<li>编写主程序，启动SpringBoot应用；</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApp.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>编写业务逻辑，服务；</li>
<li>运行主程序测试；</li>
<li>打包jar包：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行jar包：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar xxx.jar</span><br></pre></td></tr></table></figure>





<hr>
<h3 id="1-5-HelloWorld原理探究"><a href="#1-5-HelloWorld原理探究" class="headerlink" title="1.5 HelloWorld原理探究"></a>1.5 HelloWorld原理探究</h3><p>POM文件：</p>
<ol>
<li>父项目：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">父项目：</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SpringBoot的<strong>版本仲裁中心</strong>，导入依赖不需要写版本号。</p>
<ol>
<li>导入的依赖：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>spring-boot-starter-web：</p>
<p>场景启动器：帮我们导入web模块正常运行所需的依赖的组件；</p>
<p>将所有的功能场景抽取出来，做成启动器，只需要在项目中导入相关的starter，所有的依赖都会被导入，版本由spring-boot自动管理。</p>
<hr>
<h3 id="1-6-主程序类原理探究"><a href="#1-6-主程序类原理探究" class="headerlink" title="1.6 主程序类原理探究"></a>1.6 主程序类原理探究</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hello;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-9-9 下午2:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApp.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@SpringBootApplication标注在某个类上，指定SpringBoot的主配置类，由这个类来启动SpringBoot应用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br></pre></td></tr></table></figure>

<p>@SpringBootConfiguration：标注在某个类上，表示该类是SpringBoot的配置类。</p>
<p>@Configuration：配置类上标注该类。配置类也是一个组件：@Component；</p>
<p>@EnableAutoConfiguration：开启自动配置，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">需要配置的东西由SpringBoot自动配置。</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">@AutoConfigurationPackage</span><br><span class="line">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@AutoConfigurationPackage：自动配置包，给容器导入一个组件，导入的组件由AutoConfigurationPackage.Registrar；</span><br><span class="line"></span><br><span class="line">将主配置类所在的及以下所有的子包里的所有组件添加到Spring容器中。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Registrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Import：给容器中导入一些组件：AutoConfigurationImportSelector：选择哪些组件导入。</span><br><span class="line"></span><br><span class="line">	给容器中导入自动配置类（xxxAutoConfiguration）：给容器中导入场景需要的所有的组件并配置好这些组件。</span><br></pre></td></tr></table></figure>

<p><img src="https://image.youyou-2608.com/springboot/20180909151509.png" alt="配置类"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br><span class="line">    Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SpringBoot启动的时候从类路径下META-INF/spring.factories中获取EnableAutoConfiguration指定的值，将这些值导入到Spring容器中，自动配置类生效。</strong></p>
<p>需要自己指定的配置，已经由配置类自动配置好。</p>
<p>org/springframework/boot/spring-boot-autoconfigure/2.0.4.RELEASE/spring-boot-autoconfigure-2.0.4.RELEASE.jar!/META-INF/spring.factories</p>
<p><img src="https://image.youyou-2608.com/springboot/google-chrome_20180909152808.png" alt="自动配置类"></p>
<hr>
<h3 id="1-7-SpringBoot项目初始化器"><a href="#1-7-SpringBoot项目初始化器" class="headerlink" title="1.7 SpringBoot项目初始化器"></a>1.7 SpringBoot项目初始化器</h3><p>SpringBoot项目向导：</p>
<p><strong>IDEA &gt; New Project &gt; Spring Initializer &gt; 项目详情 &gt; 导入相关场景依赖。</strong></p>
<p>@RestController注解：</p>
<p>@ResponseBody和@RequestMapping注解组合。</p>
<ol>
<li>自动生成主程序；</li>
<li>/resources中目录结构：<ol>
<li>static：保存静态资源；</li>
<li>templates：存所有的模板页面(使用嵌入的tomcat，不支持JSP页面，但是可以使用模板引擎)；</li>
<li>application.properties：SpringBoot的默认配置文件。</li>
</ol>
</li>
</ol>
<hr>
<h2 id="第二章-SpringBoot配置文件"><a href="#第二章-SpringBoot配置文件" class="headerlink" title="第二章 SpringBoot配置文件"></a>第二章 SpringBoot配置文件</h2><h3 id="2-1-SpringBoot配置文件"><a href="#2-1-SpringBoot配置文件" class="headerlink" title="2.1 SpringBoot配置文件"></a>2.1 SpringBoot配置文件</h3><p>SpringBoot使用全局配置文件，配置文件名是固定的。</p>
<ul>
<li>application.properties；</li>
<li>application.yml。</li>
</ul>
<p>配置文件的作用：<strong>修改SpringBoot默认配置。</strong></p>
<p>YAML：不仅仅是一个标记语言，以数据为中心，比json和xml更适合做配置文件。</p>
<p>YAML：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="2-2-YAML基本语法"><a href="#2-2-YAML基本语法" class="headerlink" title="2.2 YAML基本语法"></a>2.2 YAML基本语法</h3><p>key: value    表示键值对，冒号之后的空格必须有的，以空格来控制层级关系。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">	<span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure>

<p><strong>属性和值大小写敏感。</strong></p>
<p>字面量：字符串默认不加单引号和双引号，<strong>双引号会转义特殊字符</strong>，<strong>单引号会转义特殊字符</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">k:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>



<p>对象(属性和值)：本质是键值对。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">student:</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">	<span class="attr">age:</span> <span class="number">14</span></span><br></pre></td></tr></table></figure>

<p>行内写法：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">student:</span> &#123;<span class="attr">name:</span> <span class="string">张三</span>,<span class="attr">age:</span> <span class="number">15</span>&#125;</span><br></pre></td></tr></table></figure>



<p>数组(List, Set)：</p>
<p>用-表示数组中的一个元素。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure>

<p>行内写法：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></table></figure>



<h4 id="2-2-1配置文件注入："><a href="#2-2-1配置文件注入：" class="headerlink" title="2.2.1配置文件注入："></a>2.2.1配置文件注入：</h4><p>application.yml文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">alive:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2018</span><span class="string">/09/11</span></span><br><span class="line">  <span class="attr">classes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dog</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>JavaBean：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-9-11 下午8:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> alive;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; classes;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, alive=&quot;</span> + alive +</span><br><span class="line">                <span class="string">&quot;, birth=&quot;</span> + birth +</span><br><span class="line">                <span class="string">&quot;, classes=&quot;</span> + classes +</span><br><span class="line">                <span class="string">&quot;, map=&quot;</span> + map +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以导入配置文件处理器之后，编写配置文件有IDE智能提示。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>@ConfigurationProperties(prefix = “person”)获取配置文件的值。</p>
<p><strong>application.properties乱码问题：file encoding勾选将properties配置文件转换成ascii码。</strong></p>
<p>配置文件的旧写法：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhagsa&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-2-2-Value注入值"><a href="#2-2-2-Value注入值" class="headerlink" title="2.2.2 @Value注入值"></a>2.2.2 @Value注入值</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;11*2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Value(&quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> alive;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; classes;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-2-3-Value和-ConfigurationProperties获取值比较："><a href="#2-2-3-Value和-ConfigurationProperties获取值比较：" class="headerlink" title="2.2.3 @Value和@ConfigurationProperties获取值比较："></a>2.2.3 @Value和@ConfigurationProperties获取值比较：</h4><table>
<thead>
<tr>
<th></th>
<th>@ConfigurationProperties</th>
<th>@Value</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>批量注入配置文件中的属性</td>
<td>单个指定变量的值</td>
</tr>
<tr>
<td>松散绑定</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>SpEL</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>JSR303数据校验</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>复杂类型封装</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<h4 id="2-2-4-Value和-ConfigurationProperties的比较"><a href="#2-2-4-Value和-ConfigurationProperties的比较" class="headerlink" title="2.2.4 @Value和@ConfigurationProperties的比较"></a>2.2.4 @Value和@ConfigurationProperties的比较</h4><p><strong>如果只是在某个业务逻辑中需要获取一下配置文件中的值，那就用@Value；如果专门编写了Java bean和配置文件进行映射，就直接使用@ConfigurationProperties。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-9-12 下午9:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/demo.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h3 id="2-3-PropertySource和-ImportSource"><a href="#2-3-PropertySource和-ImportSource" class="headerlink" title="2.3 @PropertySource和@ImportSource"></a>2.3 @PropertySource和@ImportSource</h3><p><strong>@ConfigurationProperties默认从全局配置文件中获取值。</strong></p>
<h4 id="2-3-1-PropertySource获取配置文件的值："><a href="#2-3-1-PropertySource获取配置文件的值：" class="headerlink" title="2.3.1 @PropertySource获取配置文件的值："></a>2.3.1 @PropertySource获取配置文件的值：</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@ConfigurationProperties(prefix = &quot;person&quot;)</span><br><span class="line">@PropertySource(value = &#123;&quot;classpath:person.properties&quot;&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="2-3-2-ImportSource：导入Spring配置文件，是配置文件中的配置生效。"><a href="#2-3-2-ImportSource：导入Spring配置文件，是配置文件中的配置生效。" class="headerlink" title="2.3.2 @ImportSource：导入Spring配置文件，是配置文件中的配置生效。"></a>2.3.2 @ImportSource：导入Spring配置文件，是配置文件中的配置生效。</h4><p>SpringBoot默认没有加载Spring配置文件，手动编写的配置文件也无法识别，想让配置文件生效，将@ImportSource标注在主配置类上。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.demo.service.DemoService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoServiceTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> hasDemoService = applicationContext.containsBean(<span class="string">&quot;demoService&quot;</span>);</span><br><span class="line">    System.out.println(hasDemoService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-3-SpringBoot推荐的添加组件方式"><a href="#2-3-3-SpringBoot推荐的添加组件方式" class="headerlink" title="2.3.3 SpringBoot推荐的添加组件方式"></a>2.3.3 SpringBoot推荐的添加组件方式</h4><p>SpringBoot推荐给容器中添加组件的方式：使用全注解，@Configuration标注配置类。</p>
<p>@Bean：**<u>将方法的返回值添加到容器中，组件的默认id就是方法名。</u>**</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.service.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-9-12 下午9:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@desc</span> 将方法的返回值添加到容器中，组件的默认id就是方法名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DemoService <span class="title">demoService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;给容器中添加组件&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DemoService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h3 id="2-4-配置文件占位符"><a href="#2-4-配置文件占位符" class="headerlink" title="2.4 配置文件占位符"></a>2.4 配置文件占位符</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">张三$&#123;random.value&#125;</span></span><br><span class="line">  <span class="attr">age:</span> <span class="string">$&#123;random.int&#125;</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2018</span><span class="string">/09/11</span></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">$&#123;random.value&#125;</span></span><br><span class="line">    <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">dog:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;person.hello:defau&#125;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">alive:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">classes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">v2</span></span><br></pre></td></tr></table></figure>

<ol>
<li>随机数：</li>
</ol>
<p>${random.value}，${random.int}，${random.long}，${random.int(10)}，${random.int[1,10]}</p>
<ol>
<li>占位符获取配置之前的值，${app.name:默认值}</li>
</ol>
<hr>
<h3 id="2-5-Profile多环境支持"><a href="#2-5-Profile多环境支持" class="headerlink" title="2.5 Profile多环境支持"></a>2.5 Profile多环境支持</h3><blockquote>
<p>profile为不同环境提供不同配置的功能。</p>
</blockquote>
<ol>
<li><p>多profile文件的方式：</p>
<p>在主配置文件编写的时候，文件名可以是application-{profile}.properties/application-{profile}.yml；</p>
<p>SpringBoot默认使用全局环境配置</p>
</li>
<li><p>激活指定profile：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p><strong>命令行方式：</strong></p>
<p>–spring.profiles.active=dev/prod</p>
<p><strong>虚拟机参数：</strong></p>
<p>-Dspring.profiles.active=dev/prod</p>
</li>
<li><p>yaml支持文档块的方式：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">     <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>见下图：<img src="https://image.youyou-2608.com/springboot/20180913201726.jpg" alt="厉害了"></p>
<hr>
<h3 id="2-6-配置文件加载位置"><a href="#2-6-配置文件加载位置" class="headerlink" title="2.6 配置文件加载位置"></a>2.6 配置文件加载位置</h3><p>SpringBoot启动会扫描以下位置的application.properties或者application.yml文件作为SpringBoot的默认配置文件：</p>
<ul>
<li>file：./config/</li>
<li>file：./</li>
<li>classpath：/config/</li>
<li>classpath：/</li>
</ul>
<p><strong>以上位置优先级从高到低。所有位置的配置文件都会被加载，高优先级的配置会覆盖低优先级的配置，高优先级和低优先级配置文件形成互补配置。</strong></p>
<p>server.context-path=/config02 -&gt; <a target="_blank" rel="noopener" href="http://localhost:8080/config02/hello.do">http://localhost:8080/config02/hello.do</a></p>
<p><strong>还可以通过spring.config.location来改变默认的配置文件位置(项目打包后可以使用命令行参数的形式启动项目时候来指定配置文件的位置，指定的配置文件和默认加载的配置文件会形成互补配置)。</strong></p>
<p>见下图：</p>
<p><img src="https://image.youyou-2608.com/springboot/20180913202351.jpg" alt="图片丢失"></p>
<hr>
<h3 id="2-7-外部配置文件加载顺序"><a href="#2-7-外部配置文件加载顺序" class="headerlink" title="2.7 外部配置文件加载顺序"></a>2.7 外部配置文件加载顺序</h3><p>SpringBoot也可以从以下位置加载配置文件，优先级从高到低，<strong>高优先级的配置会覆盖低优先级的配置，高低优先级的配置会形成互补配置</strong>。</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#using-boot-devtools-globalsettings">Devtools global settings properties</a> on your home directory (<code>~/.spring-boot-devtools.properties</code> when devtools is active).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.9.RELEASE/javadoc-api/org/springframework/test/context/TestPropertySource.html"><code>@TestPropertySource</code></a> annotations on your tests.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest#properties</code></a> annotation attribute on your tests.</li>
<li>Command line arguments.</li>
<li>Properties from <code>SPRING_APPLICATION_JSON</code> (inline JSON embedded in an environment variable or system property).</li>
<li><code>ServletConfig</code> init parameters.</li>
<li><code>ServletContext</code> init parameters.</li>
<li>JNDI attributes from <code>java:comp/env</code>.</li>
<li>Java System properties (<code>System.getProperties()</code>).</li>
<li>OS environment variables.</li>
<li>A <code>RandomValuePropertySource</code> that has properties only in <code>random.*</code>.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties">Profile-specific application properties</a> outside of your packaged jar (<code>application-&#123;profile&#125;.properties</code> and YAML variants).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-profile-specific-properties">Profile-specific application properties</a> packaged inside your jar (<code>application-&#123;profile&#125;.properties</code> and YAML variants).</li>
<li>Application properties outside of your packaged jar (<code>application.properties</code> and YAML variants).</li>
<li>Application properties packaged inside your jar (<code>application.properties</code> and YAML variants).</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.9.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> annotations on your <code>@Configuration</code> classes.</li>
<li>Default properties (specified by setting <code>SpringApplication.setDefaultProperties</code>).</li>
</ol>
<p>由jar包外向jar包内进行查找。</p>
<p>命令行参数（多个参数用空格分开）；</p>
<ul>
<li>java -jar xxx.jar –server.port=8081 server.context.path=/ab</li>
</ul>
<p>优先加载带profile的配置文件。</p>
<ul>
<li>jar包外的application-{profile}或application-{yml}或不带spring.profile的配置文件；</li>
<li>jar包内的application-{profile}或application-{yml}或不带spring.profile的配置文件；</li>
</ul>
<p>再加载带不profile的配置文件。</p>
<ul>
<li>jar包外的application-{profile}或application-{yml}或不带spring.profile的配置文件；</li>
<li>jar包内的application-{profile}或application-{yml}或不带spring.profile的配置文件；</li>
</ul>
<ul>
<li>@Configuration注解类上的@PropertySource；</li>
<li>通过SpringApplication.setDefaultProperties指定的默认属性。</li>
</ul>
<p>详细参见SpringBoot官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features">SpringBoot外部配置文件加载顺序</a></p>
<hr>
<h3 id="2-8-自动配置原理"><a href="#2-8-自动配置原理" class="headerlink" title="2.8 自动配置原理"></a>2.8 自动配置原理</h3><p>配置文件能写什么，怎么写？</p>
<p>自动配置原理：</p>
<ol>
<li>SpringBoot在启动的时候加载主配置类，开启了自动配置功能：@EnableAutoConfiguration；</li>
<li>@EnableAutoConfiguration的作用：<ol>
<li>利用@EnableAutoConfigurationImportSelector给容器导入一些组件；</li>
<li>可以查看selectImports中的内容；</li>
<li>List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes) 方法；<ul>
<li>SpringFactoriesLoader.loadFactoryNames()；</li>
<li>扫描所有jar包类路径下：META-INF/spring.factories；</li>
<li>将扫描到的文件内容加载包装成properties对象。</li>
</ul>
</li>
</ol>
</li>
<li>每一个自动配置类进行功能的自动配置；</li>
<li>所有在配置文件中能配置的属性都在xxxProperties类中配置着，配置文件能配置什么都参照配置文件中的值；</li>
</ol>
<p>SpringBoot的特点：</p>
<ol>
<li>SpringBoot启动时会加载大量的自动配置类；</li>
<li>看SpringBoot有没有自动配置类；</li>
<li>如果有，不用自己再写自动配置类。</li>
<li>给容器中自动配置类添加组件的时候，会从properties类中读取某些属性，我们就可以在配置文件中指定这些属性的值。</li>
</ol>
<hr>
<h3 id="2-9-Conditional自动配置"><a href="#2-9-Conditional自动配置" class="headerlink" title="2.9 @Conditional自动配置"></a>2.9 @Conditional自动配置</h3><blockquote>
<p>自动配置类需要在一定条件下才能生效。</p>
</blockquote>
<p>注解的作用：必须是@Conditional指定的条件成立，才能给容器中添加组件，配置里面的所有内容才生效。</p>
<table>
<thead>
<tr>
<th>@Conditional扩展</th>
<th>作用(判断是否满足当前条件)</th>
</tr>
</thead>
<tbody><tr>
<td>@ConditionalOnJava</td>
<td>系统的Java版本是否符合要求</td>
</tr>
<tr>
<td>@ConditionalOnBean</td>
<td>容器中存在指定的bean</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>容器中不存在指定的bean</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>满足SpEL表达式</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>容器中有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>容器中没有指定的类</td>
</tr>
<tr>
<td>@ConditionalOnProperty</td>
<td>系统中指定属性是有指定的值</td>
</tr>
<tr>
<td>@ConditionalOnResource</td>
<td>类路径下是否存在指定资源文件</td>
</tr>
<tr>
<td>@ConditionalOnWebApplication</td>
<td>当前是web环境</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>当前不是web环境</td>
</tr>
<tr>
<td>@ConditionalOnJndi</td>
<td>JNDI存在指定项</td>
</tr>
<tr>
<td>@ConditionalOnSingleCandidate</td>
<td>容器中只有一个指定的bean，或者这个bean是首选的bean</td>
</tr>
</tbody></table>
<p>自动配置文件：org/springframework/boot/spring-boot-autoconfigure/2.0.5.RELEASE/spring-boot-autoconfigure-2.0.5.RELEASE.jar!/META-INF/spring.factories</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.reactor.core.ReactorCoreAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.servlet.SecurityRequestMatcherProviderAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.security.oauth2.client.OAuth2ClientAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span></span><br></pre></td></tr></table></figure>



<p>开启SpringBoot的debug，可以通过debug=true让控制台打印自动配置报告，便可以方便的知道哪些自动配置类生效了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">============================</span><br><span class="line">CONDITIONS EVALUATION REPORT</span><br><span class="line">============================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   CodecsAutoConfiguration matched:</span><br><span class="line">      - @ConditionalOnClass found required class &#x27;org.springframework.http.codec.CodecConfigurer&#x27;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   CodecsAutoConfiguration.JacksonCodecConfiguration matched:</span><br><span class="line">      - @ConditionalOnClass found required class &#x27;com.fasterxml.jackson.databind.ObjectMapper&#x27;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Negative matches:</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - @ConditionalOnClass did not find required classes &#x27;javax.jms.ConnectionFactory&#x27;, &#x27;org.apache.activemq.ActiveMQConnectionFactory&#x27; (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - @ConditionalOnClass did not find required classes &#x27;org.aspectj.lang.annotation.Aspect&#x27;, &#x27;org.aspectj.lang.reflect.Advice&#x27;, &#x27;org.aspectj.weaver.AnnotatedElement&#x27; (OnClassCondition)</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="第三章-SpringBoot与日志"><a href="#第三章-SpringBoot与日志" class="headerlink" title="第三章 SpringBoot与日志"></a>第三章 SpringBoot与日志</h2><hr>
<h3 id="3-1-日志框架"><a href="#3-1-日志框架" class="headerlink" title="3.1 日志框架"></a>3.1 日志框架</h3><ul>
<li>System.out.println(“welcome!”);  不利于代码维护；</li>
<li>使用日志框架；</li>
<li>加入异步，自动归档等功能；</li>
<li>与程序耦合控制；</li>
<li>统一的接口层：日志门面。</li>
</ul>
<p>常见的日志框架：</p>
<ul>
<li>JUL（java.util.logging）；</li>
<li>JCL；</li>
<li>jboss-logging；</li>
<li>logback；</li>
<li>log4j；</li>
<li>log4j2；</li>
<li>slf4j；</li>
</ul>
<p>日志门面：SLF4J；</p>
<p>日志实现：Logback。</p>
<p>SpringBoot：底层是Spring框架，SpringBoot框架默认是JCL</p>
<p><strong>SpringBoot选用SLF4J，Logback。</strong></p>
<hr>
<h3 id="3-2-SLF4J的使用"><a href="#3-2-SLF4J的使用" class="headerlink" title="3.2 SLF4J的使用"></a>3.2 SLF4J的使用</h3><hr>
<h4 id="3-2-1-如何在系统中使用SLF4J"><a href="#3-2-1-如何在系统中使用SLF4J" class="headerlink" title="3.2.1 如何在系统中使用SLF4J"></a>3.2.1 如何在系统中使用SLF4J</h4><p>开发的时候，日志记录的方法调用，应该直接调用日志抽象层里的方法，而不是日志的实现类。</p>
<p>给系统导入slf4j的jar和logback的实现jar：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>图示：</p>
<p><img src="https://image.youyou-2608.com/springboot/concrete-bindings.png" alt="具体关系"></p>
<p>每一个日志框架都有自己的配置文件，使用slf4j以后，<strong>配置文件还是作为日志实现框架本身的配置文件。</strong></p>
<hr>
<h4 id="3-2-2-遗留问题"><a href="#3-2-2-遗留问题" class="headerlink" title="3.2.2 遗留问题"></a>3.2.2 遗留问题</h4><p>a（slf4j + logback）：Spring(commons-logging)，Hibernate(jboss-logging)</p>
<p>统一日志记录，即便是别的框架也使用同一日志框架。</p>
<p><img src="https://image.youyou-2608.com/springboot/legacy.png"></p>
<p>如何让系统中所有的日志都统一到slf4j：</p>
<ol>
<li><u>将系统中其他日志框架排除在外；</u></li>
<li><u>用中间适配层包替换原有日志框架；</u></li>
<li><u>导入slf4j其他的实现。</u></li>
</ol>
<hr>
<h3 id="3-3-SpringBoot日志关系"><a href="#3-3-SpringBoot日志关系" class="headerlink" title="3.3 SpringBoot日志关系"></a>3.3 SpringBoot日志关系</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>SpringBoot的日志功能：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>SpringBoot底层依赖关系（pom.xml文件，show diagram查看maven项目依赖关系）：</p>
<p><img src="https://image.youyou-2608.com/springboot/irei.png"></p>
<ol>
<li>SpringBoot底层也是用slf4j + logback的方式进行日志记录；</li>
<li>SpringBoot也把其他的日志都替换成了slf4j；</li>
<li>中间替换包；</li>
<li>如果要引入其他框架，一定要把这个框架的默认日志依赖移除。</li>
</ol>
<p><strong>SpringBoot自动适应所有的日志框架，而且底层使用了slf4j + logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖移除掉。</strong></p>
<hr>
<h3 id="3-4-SpringBoot默认日志配置"><a href="#3-4-SpringBoot默认日志配置" class="headerlink" title="3.4 SpringBoot默认日志配置"></a>3.4 SpringBoot默认日志配置</h3><p>日志的级别，由低到高，可以调整日志输出的级别：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="comment">//日志的级别，由低到高</span></span><br><span class="line">logger.trace(<span class="string">&quot;这是日志...&quot;</span>);</span><br><span class="line">logger.debug(<span class="string">&quot;这是debug日志...&quot;</span>);</span><br><span class="line">logger.info(<span class="string">&quot;这是Info信息...&quot;</span>);</span><br><span class="line">logger.warn(<span class="string">&quot;这是警告...&quot;</span>);</span><br><span class="line">logger.error(<span class="string">&quot;这是错误信息...&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>SpringBoot默认日志输出级别为info。</p>
<p>可以在application.yml中自定义日志输出级别： logging.level.com.hape.nmsl=trace</p>
<p>在当前项目下生成日志文件：logging.file=springboot.log</p>
<p>不指定路径在项目路径下生成日志文件。</p>
<p>logfile优先级高于logpath。</p>
<p>logpath：指定日志文件的路径，默认文件名spring.log。</p>
<p>logging.pattern.console：控制台输出日志的格式。</p>
<p>logging.pattern.file：日志文件输出格式。</p>
<p>日志输出格式：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">%d：表示日期时间；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%thread：表示线程号；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%-5level：级别从左显示5个字符宽度；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%logger&#123;50&#125;：表示logger名字最长50个字符，否则按照句点分割；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%msg：日志信息；</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%n：换行符。</span></span><br></pre></td></tr></table></figure>

<p>日志格式配置实例：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">%d&#123;yyyy-MM-dd</span> <span class="string">HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="3-5-指定日志文件和日志profile功能"><a href="#3-5-指定日志文件和日志profile功能" class="headerlink" title="3.5 指定日志文件和日志profile功能"></a>3.5 指定日志文件和日志profile功能</h3><p>给类路径下放上每个日志框架自己配置文件即可，</p>
<blockquote>
<p>Because the standard <code>logback.xml</code> configuration file is loaded too early, you cannot use extensions in it. You need to either use <code>logback-spring.xml</code> or define a <code>logging.config</code> property.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Logging System</th>
<th>Customization</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code>, or <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<p>logback.xml：直接被日志框架识别；</p>
<p><strong>logback-spring.xml：日志框架不直接加载配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级功能profile。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">可以指定某一段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;staging&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev, staging&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!production&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>







<hr>
<h3 id="3-6-切换日志框架"><a href="#3-6-切换日志框架" class="headerlink" title="3.6 切换日志框架"></a>3.6 切换日志框架</h3><p>可以按照slf4j适配图进行相关的切换。</p>
<ol>
<li>排除不使用的包；</li>
<li>导入相关的适配包；</li>
</ol>
<p>不推荐更换SpringBoot默认使用的日志记录框架。</p>
<hr>
<h2 id="第四章-SpringBoot与Web开发"><a href="#第四章-SpringBoot与Web开发" class="headerlink" title="第四章 SpringBoot与Web开发"></a>第四章 SpringBoot与Web开发</h2><p>使用SpringBoot：</p>
<ul>
<li>创建SpringBoot应用，选中需要的模块；</li>
<li>SpringBoot自动配置好场景，需要在配置文件中指定少量配置，即可运行程序；</li>
<li>编写相关的业务逻辑。</li>
</ul>
<p>依赖于SpringBoot的自动配置。</p>
<hr>
<h3 id="4-1-webjar与静态资源映射规则"><a href="#4-1-webjar与静态资源映射规则" class="headerlink" title="4.1 webjar与静态资源映射规则"></a>4.1 webjar与静态资源映射规则</h3><p>SpringBoot对静态资源的映射规则：（WebMvcAutoConfiguration.java）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">    CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache()</span><br><span class="line">        .getCachecontrol().toHttpCacheControl();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry</span><br><span class="line">                                             .addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                                             .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod))</span><br><span class="line">                                             .setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(</span><br><span class="line">            registry.addResourceHandler(staticPathPattern)</span><br><span class="line">            .addResourceLocations(getResourceLocations(</span><br><span class="line">                <span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">            .setCachePeriod(getSeconds(cachePeriod))</span><br><span class="line">            .setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>所有的/webjars/**，都到classpath:/META-INF/resources/webjars找资源；</p>
<p>webjars以jar包的方式引入静态资源。</p>
<p><img src="https://image.youyou-2608.com/springboot/webjars.png"></p>
</li>
</ul>
<p>在访问的时候只需要写webjars下的资源名称即可。（<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.3.1-1/jquery.js%EF%BC%89">http://localhost:8080/webjars/jquery/3.3.1-1/jquery.js）</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1-1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>访问当前项目下的任何资源（静态资源的文件夹）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;, </span><br><span class="line">&quot;classpath:/resources/&quot;,</span><br><span class="line">&quot;classpath:/static/&quot;,</span><br><span class="line">&quot;classpath:/public/&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>配置欢迎页</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    ApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WelcomePageHandlerMapping(</span><br><span class="line">        <span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext),</span><br><span class="line">        applicationContext, getWelcomePage(),</span><br><span class="line">        <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态文件夹下的所有index.html页面；</p>
<p>映射到 private String staticPathPattern = “/**”;</p>
</li>
</ul>
<ul>
<li><p>配置喜欢的图标</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = &quot;spring.mvc.favicon.enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FaviconConfiguration</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ResourceLoader resourceLoader;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>映射到**favicon.ico静态资源文件夹。</p>
</li>
</ul>
<hr>
<h3 id="4-2-引入Thymeleaf模板引擎"><a href="#4-2-引入Thymeleaf模板引擎" class="headerlink" title="4.2 引入Thymeleaf模板引擎"></a>4.2 引入Thymeleaf模板引擎</h3><blockquote>
<p>thymeleaf, jsp, freemaker, velocity</p>
</blockquote>
<p>SpringBoot推荐的thymeleaf：</p>
<ol>
<li>引入thymeleaf；</li>
<li>自定义thymeleaf版本。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.2.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--布局功能支持程序  thymeleaf3  layout2以上版本适配--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.layout.dialect.version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">thymeleaf.layout.dialect.version</span>&gt;</span></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="4-3-Thymeleaf语法"><a href="#4-3-Thymeleaf语法" class="headerlink" title="4.3 Thymeleaf语法"></a>4.3 Thymeleaf语法</h3><p>默认请求路径：classpath:templates/xxx.html</p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/documentation.html">Thymeleaf参考文档</a></p>
<p>使用方法：</p>
<ul>
<li><p>导入Thymeleaf名称空间；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http:y//www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用Thymeleaf语法；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hello&#125;&quot;</span>&gt;</span>显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>thymeleaf语法规则：</p>
<ul>
<li><p>th:text：改变text文本值；</p>
</li>
<li><p>th:任意属性都可以替换；</p>
</li>
<li><p>文档第十章/Attributes/优先级；</p>
<p><img src="https://image.youyou-2608.com/springboot/DeepinScreenshot_select-area_20181001125611.png"></p>
</li>
</ul>
</li>
<li><p>thymeleaf表达式；</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: $&#123;...&#125;</span></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *&#123;...&#125;</span></span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #&#123;...&#125;</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @&#123;...&#125;</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~&#123;...&#125;</span></span><br><span class="line"><span class="attr">Literals</span></span><br><span class="line">    <span class="attr">Text</span> <span class="string">literals: &#x27;one text&#x27; , &#x27;Another one!&#x27; ,...</span></span><br><span class="line">    <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,...</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">    <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,...</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line">    <span class="attr">Arithmetic</span> <span class="string">operations:</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:</span></span><br><span class="line">    <span class="meta">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="meta">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">	<span class="attr">Page</span> <span class="string">17 of 106No-Operation: _</span></span><br></pre></td></tr></table></figure>

<p>内置对象：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ctx : the context object.</span></span><br><span class="line"><span class="comment">#vars: the context variables.</span></span><br><span class="line"><span class="comment">#locale : the context locale.</span></span><br><span class="line"><span class="comment">#request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">#response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">#session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">#servletContext : (only in Web Contexts) the ServletContext object.</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="4-4-SpringMVC自动配置功能"><a href="#4-4-SpringMVC自动配置功能" class="headerlink" title="4.4 SpringMVC自动配置功能"></a>4.4 SpringMVC自动配置功能</h3><p>SpringBoot文档地址：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications">官方文档地址</a></p>
<h4 id="4-4-1-SpringMVC自动配置项"><a href="#4-4-1-SpringMVC自动配置项" class="headerlink" title="4.4.1 SpringMVC自动配置项"></a>4.4.1 SpringMVC自动配置项</h4><p>SpringMVC自动配置：</p>
<ul>
<li>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</li>
<li>Support for serving static resources, including support for WebJars (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-static-content">later in this document</a>)).</li>
<li>Automatic registration of <code>Converter</code>, <code>GenericConverter</code>, and <code>Formatter</code> beans.</li>
<li>Support for <code>HttpMessageConverters</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-message-converters">later in this document</a>).</li>
<li>Automatic registration of <code>MessageCodesResolver</code> (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-spring-message-codes">later in this document</a>).</li>
<li>Static <code>index.html</code> support.</li>
<li>Custom <code>Favicon</code> support (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-favicon">later in this document</a>).</li>
<li>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (covered <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-web-binding-initializer">later in this document</a>).</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(ViewResolver.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;viewResolver&quot;, value = ContentNegotiatingViewResolver.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ContentNegotiatingViewResolver <span class="title">viewResolver</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    ContentNegotiatingViewResolver resolver = <span class="keyword">new</span> ContentNegotiatingViewResolver();</span><br><span class="line">    resolver.setContentNegotiationManager(</span><br><span class="line">        beanFactory.getBean(ContentNegotiationManager.class));</span><br><span class="line">    <span class="comment">// ContentNegotiatingViewResolver uses all the other view resolvers to locate</span></span><br><span class="line">    <span class="comment">// a view so it should have a high precedence</span></span><br><span class="line">    resolver.setOrder(Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Converter&lt;?, ?&gt; converter : getBeansOfType(Converter.class)) &#123;</span><br><span class="line">        registry.addConverter(converter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (GenericConverter converter : getBeansOfType(GenericConverter.class)) &#123;</span><br><span class="line">        registry.addConverter(converter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Formatter&lt;?&gt; formatter : getBeansOfType(Formatter.class)) &#123;</span><br><span class="line">        registry.addFormatter(formatter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.messageConvertersProvider.ifAvailable((customConverters) -&gt; converters</span><br><span class="line">                                               .addAll(customConverters.getConverters()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>如果用户有配置(@Bean，@Component)，则使用组合配置；</li>
</ul>
<h4 id="4-4-2-扩展SpringMVC配置"><a href="#4-4-2-扩展SpringMVC配置" class="headerlink" title="4.4.2 扩展SpringMVC配置"></a>4.4.2 扩展SpringMVC配置</h4><p>添加一个配置类并且继承自WebMvcConfigurerAdapter。</p>
<p>将hello.do请求映射到hello.html视图：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-10-1 下午1:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        super.addViewControllers(registry);</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/hello.do&quot;</span>).setViewName(<span class="string">&quot;/hello.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>WebMvcAutoConfiguration是SpringMVC的自动配置类；</li>
<li>在做其他自动配置时会导入：@Import(EnableWebMvcConfiguration.class)。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>容器中所有的WebMvcConfiguration都会被调用。</p>
<p>所有的配置都会共同起作用。</p>
</li>
</ul>
<h4 id="4-4-3-全面接管SpringMVC"><a href="#4-4-3-全面接管SpringMVC" class="headerlink" title="4.4.3 全面接管SpringMVC"></a>4.4.3 全面接管SpringMVC</h4><p>在配置类中添加@EnableWebMvc：丢弃所有的自动配置，手动配置所有的配置。</p>
<p>原理：</p>
<p>WebMvc：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DelegatingWebMvcConfiguration：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WebMvcAutoConfiguration：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="comment">//容器中缺少此组件，该自动配置生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br></pre></td></tr></table></figure>





<hr>
<h3 id="4-5-引入资源"><a href="#4-5-引入资源" class="headerlink" title="4.5 引入资源"></a>4.5 引入资源</h3><p>SpringBoot中使用<strong>webjars</strong>引入jquery和bootstrap之类的资源：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;webjars/bootstrap/4.1.3/css/bootstrap.css&#125;&quot;</span> <span class="attr">th:type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>即使更换项目访问名也可以正常加载静态资源。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-10-1 下午1:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        super.addViewControllers(registry);</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/hello.do&quot;</span>).setViewName(<span class="string">&quot;/hello.html&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;/hello.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title">webMvcConfigurerAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurerAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;/hello.html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h3 id="4-6-国际化"><a href="#4-6-国际化" class="headerlink" title="4.6 国际化"></a>4.6 国际化</h3><ol>
<li><strong>编写国际化配置文件；</strong></li>
<li>使用ResourceBundleMessageSource管理国际化资源文件；</li>
<li>在页面使用fmt:message取出国际化内容。</li>
</ol>
<p>配置如下图：</p>
<p><img src="https://image.youyou-2608.com/springboot/international.png"></p>
<p>SpringBoot自动配置（MessageSourceAutoConfiguration.java）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">//类路径下配置文件spring.messages</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.messages&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSourceProperties <span class="title">messageSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MessageSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MessageSourceProperties properties = messageSourceProperties();</span><br><span class="line">    ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(properties.getBasename())) &#123;</span><br><span class="line">        <span class="comment">//设置国际化资源文件的基础名（去除国际语言代码）</span></span><br><span class="line">        messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">            StringUtils.trimAllWhitespace(properties.getBasename())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (properties.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setDefaultEncoding(properties.getEncoding().name());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setFallbackToSystemLocale(properties.isFallbackToSystemLocale());</span><br><span class="line">    Duration cacheDuration = properties.getCacheDuration();</span><br><span class="line">    <span class="keyword">if</span> (cacheDuration != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setCacheMillis(cacheDuration.toMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setAlwaysUseMessageFormat(properties.isAlwaysUseMessageFormat());</span><br><span class="line">    messageSource.setUseCodeAsDefaultMessage(properties.isUseCodeAsDefaultMessage());</span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置配置文件地址：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.message</span>=<span class="string">login</span></span><br></pre></td></tr></table></figure>

<p>页面中获取国际化资源：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">lable</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:message</span>=<span class="string">&quot;#&#123;login.tip&#125;&quot;</span>&gt;</span>Tips<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lable</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:message</span>=<span class="string">&quot;#&#123;login.username&#125;&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lable</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:message</span>=<span class="string">&quot;#&#123;login.password&#125;&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lable</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:message</span>=<span class="string">&quot;#&#123;login.remember&#125;&quot;</span>&gt;</span>remember<span class="tag">&lt;/<span class="name">lable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>浏览器根据浏览器语言设置的信息自动切换国际化。</p>
<p>SpringMVC区域信息组件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties</span><br><span class="line">        .getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">    AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">    localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//默认根据请求头获取的区域信息展示国际化信息。</span></span><br></pre></td></tr></table></figure>



<p><strong>可以在请求参数上携带区域信息实现国际化：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://localhost:8080/hello.do?language=zh_CN</span><br><span class="line">https://localhost:8080/hello.do?language=en_US</span><br></pre></td></tr></table></figure>

<p>手动配置区域信息解析器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.web.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-10-3 下午4:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest httpServletRequest)</span> </span>&#123;</span><br><span class="line">        String language = httpServletRequest.getParameter(<span class="string">&quot;language&quot;</span>);</span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language)) &#123;</span><br><span class="line">            String[] regionInfo = language.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> Locale(regionInfo[<span class="number">0</span>], regionInfo[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<hr>
<h3 id="4-7-拦截器"><a href="#4-7-拦截器" class="headerlink" title="4.7 拦截器"></a>4.7 拦截器</h3><ul>
<li>PostMapping()：RestfulAPI注解；</li>
<li>开发期间禁用Thymeleaf的缓存：spring.thymeleaf.cache=false；</li>
<li>错误消息的显示；</li>
<li>防止表单重复提交，添加视图视图映射后，使用重定向。</li>
<li>使用拦截器进行身份校验；</li>
<li>编写拦截器，在配置类中注册拦截器。</li>
<li>页面中使用Thymeleaf获取值。</li>
</ul>
<hr>
<h3 id="4-8-CRUD实验"><a href="#4-8-CRUD实验" class="headerlink" title="4.8 CRUD实验"></a>4.8 CRUD实验</h3><h4 id="4-8-1-实验要求"><a href="#4-8-1-实验要求" class="headerlink" title="4.8.1 实验要求"></a>4.8.1 实验要求</h4><p>实验要求：</p>
<ol>
<li><p>RestfulAPI风格：</p>
<ol>
<li>URI：/资源名称/资源标识；</li>
<li>HTTP请求方式区分对资源的CRUD操作；</li>
</ol>
<table>
<thead>
<tr>
<th>操作</th>
<th>普通CRUD</th>
<th>RestfulCRUD</th>
</tr>
</thead>
<tbody><tr>
<td>查询</td>
<td>getEmp</td>
<td>emp—GET</td>
</tr>
<tr>
<td>添加</td>
<td>addEmp?xxx</td>
<td>emp—POST</td>
</tr>
<tr>
<td>修改</td>
<td>updateEmp?id=xxx&amp;xxx=xxx</td>
<td>emp/{id}—PUT</td>
</tr>
<tr>
<td>删除</td>
<td>deleteEmp?id=1</td>
<td>emp/{id}—DELETE</td>
</tr>
</tbody></table>
</li>
</ol>
<ol>
<li><p>实验的请求架构：</p>
<table>
<thead>
<tr>
<th></th>
<th>请求URI</th>
<th>请求方式</th>
</tr>
</thead>
<tbody><tr>
<td>查询所有的员工</td>
<td>emps</td>
<td>GET</td>
</tr>
<tr>
<td>查询某个员工</td>
<td>emp/{id}</td>
<td>GET</td>
</tr>
<tr>
<td>来到添加界面</td>
<td>emp</td>
<td>GET</td>
</tr>
<tr>
<td>添加员工</td>
<td>emp</td>
<td>POST</td>
</tr>
<tr>
<td>来到修改界面</td>
<td>emp/{id}</td>
<td>PUT</td>
</tr>
<tr>
<td>修改员工</td>
<td>emp</td>
<td>PUT</td>
</tr>
<tr>
<td>删除员工</td>
<td>emp/{id}</td>
<td>DELETE</td>
</tr>
</tbody></table>
</li>
</ol>
<h4 id="4-8-2-公共页面抽取—列表页"><a href="#4-8-2-公共页面抽取—列表页" class="headerlink" title="4.8.2 公共页面抽取—列表页"></a>4.8.2 公共页面抽取—列表页</h4><ol>
<li><p>利用Thymeleaf抽取公共页面；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>“~{templatename::selector}”：模板名选择器；</p>
<p>~{templatename::fragmentname}：模板名：片断名。</p>
</li>
<li><p>默认效果：</p>
<p>insert片段都在div标签中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>三种引入功能片段的th属性：</p>
<ol>
<li><strong>th:insert：将公共片段整个插入到声明引入的元素中；</strong></li>
<li><strong>th:replace：将声明引入的元素替换为公共片段；</strong></li>
<li><strong>th:include：将被引入的片段的内容包含进这个标签中。</strong></li>
</ol>
</li>
</ol>
<hr>
<h4 id="4-8-3-链接高亮-amp-列表完成"><a href="#4-8-3-链接高亮-amp-列表完成" class="headerlink" title="4.8.3 链接高亮&amp;列表完成"></a>4.8.3 链接高亮&amp;列表完成</h4><p><img src="https://image.youyou-2608.com/springboot/paramterizable.png"></p>
<p><strong>实现方法：引入公共片段时传入相关参数，公共片段根据参数高亮相关部分。</strong></p>
<p>Thymeleaf日期工具对象(文档附录 &gt; dates)：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line"><span class="params">#</span>dates : methods for java.util.Date objects: formatting, component extraction, etc.</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">$&#123;#dates.format(date,</span> <span class="string">&#x27;dd/MMM/yyyy HH:mm&#x27;)&#125;</span></span><br><span class="line"><span class="meta">$&#123;#dates.arrayFormat(datesArray,</span> <span class="string">&#x27;dd/MMM/yyyy HH:mm&#x27;)&#125;</span></span><br><span class="line"><span class="meta">$&#123;#dates.listFormat(datesList,</span> <span class="string">&#x27;dd/MMM/yyyy HH:mm&#x27;)&#125;</span></span><br><span class="line"><span class="meta">$&#123;#dates.setFormat(datesSet,</span> <span class="string">&#x27;dd/MMM/yyyy HH:mm&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>



<hr>
<h4 id="4-8-4-添加员工-gt-来到添加页面"><a href="#4-8-4-添加员工-gt-来到添加页面" class="headerlink" title="4.8.4 添加员工 &gt; 来到添加页面"></a>4.8.4 添加员工 &gt; 来到添加页面</h4><ol>
<li>添加表单：Bootstrap官网模板直接复制；</li>
<li>通过 **添加 **按钮跳转到添加页面；</li>
<li>使用th:each完成部门的遍历；</li>
</ol>
<hr>
<h4 id="4-8-5-添加员工-gt-完成添加"><a href="#4-8-5-添加员工-gt-完成添加" class="headerlink" title="4.8.5 添加员工 &gt; 完成添加"></a>4.8.5 添加员工 &gt; 完成添加</h4><ol>
<li>完成添加后 <strong>重定向</strong> 至列表页面（forward或者redirect）；</li>
<li>提交的数据格式问题：日期格式：<ol>
<li>日期格式化：SpringMVC将页面提交的值需要转换成指定的类型；</li>
<li><strong>在配置文件中自定义表单提交的日期格式。</strong></li>
</ol>
</li>
</ol>
<hr>
<h4 id="4-8-6-修改员工信息"><a href="#4-8-6-修改员工信息" class="headerlink" title="4.8.6 修改员工信息"></a>4.8.6 修改员工信息</h4><ol>
<li>配置HiddenHttpMethodFilter；</li>
</ol>
<hr>
<h4 id="4-8-7-删除员工"><a href="#4-8-7-删除员工" class="headerlink" title="4.8.7 删除员工"></a>4.8.7 删除员工</h4><hr>
<h3 id="4-9-定制错误页面"><a href="#4-9-定制错误页面" class="headerlink" title="4.9 定制错误页面"></a>4.9 定制错误页面</h3><ol>
<li><p>默认出错处理：返回一个默认的错误处理页面：在页面共享信息；</p>
</li>
<li><p>如果是其他客户端，默认响应一个json数据；</p>
</li>
<li><p>可以参照ErrorAutoConfiguration，错误处理的自动配置，在容器中添加如下组件：</p>
<ol>
<li><p>DefaultErrorAttributes；</p>
</li>
<li><p>BasicErrorController：处理默认的error错误请求；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(produces = &quot;text/html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">                              HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">        request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ErrorPageCustomizer：系统出现错误，来到/error请求进行处理：web.xml；</p>
</li>
<li><p>DefaultErrorViewResolver；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    Map&lt;Series, String&gt; views = <span class="keyword">new</span> EnumMap&lt;&gt;(Series.class);</span><br><span class="line">    views.put(Series.CLIENT_ERROR, <span class="string">&quot;4xx&quot;</span>);</span><br><span class="line">    views.put(Series.SERVER_ERROR, <span class="string">&quot;5xx&quot;</span>);</span><br><span class="line">    SERIES_VIEWS = Collections.unmodifiableMap(views);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    ModelAndView modelAndView = resolve(String.valueOf(status), model);</span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">        modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    String errorViewName = <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">    TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders</span><br><span class="line">        .getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<p>定制自定义错误页面：</p>
<ol>
<li><p>有模板引擎的情况下：error/状态码，将错误命名为status_code.html放在classpath:error/下，发生此错误会来到该页面；</p>
<p>可以使用4xx和5xx作为错误页面的文件名来匹配该类型的所有错误，精确匹配优先；</p>
<p>页面能获取的信息：</p>
<ol>
<li>timestamp；</li>
<li>message；</li>
<li>status code；</li>
<li>exception；</li>
<li>errors。</li>
</ol>
</li>
<li><p>没有模板引擎：静态资源文件夹下寻找。</p>
</li>
</ol>
<p>定制自定义json数据：</p>
<ol>
<li><p>没有自适应效果，浏览器和客户端返回的都是json数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@ExceptionHandler</span></span><br><span class="line"><span class="meta">@Response</span></span><br></pre></td></tr></table></figure></li>
<li><p>自适应效果：转发给/error进行自适应效果处理，给request中传入自己的参数：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(produces = &quot;text/html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">                              HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">        request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">                                                  isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>将自定义错误信息携带：</p>
<p>响应数据由getErrorAttributes()获取：</p>
<ol>
<li><p>编写一个ErrorController的实现类或者AbstractErrorController的子类，放在容器中；</p>
</li>
<li><p>页面上能用的数据或者json返回的数据都是errorAttributes.getErrorAttributes得到；DefaultErrorAttributes.getErrorAttributes()进行错误处理。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.web.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.error.DefaultErrorAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhulongkun20@163.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 18-10-7 下午4:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorHandler</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            org.springframework.web.reactive.function.server.ServerRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getErrorAttributes(request, includeStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<hr>
<h2 id="第五章-配置嵌入式Servlet容器"><a href="#第五章-配置嵌入式Servlet容器" class="headerlink" title="第五章 配置嵌入式Servlet容器"></a>第五章 配置嵌入式Servlet容器</h2><hr>
<h3 id="5-1-定制嵌入式Servlet容器"><a href="#5-1-定制嵌入式Servlet容器" class="headerlink" title="5.1 定制嵌入式Servlet容器"></a>5.1 定制嵌入式Servlet容器</h3><p>默认使用嵌入式tomcat8.5.4作为嵌入式的Servlet容器；</p>
<p><img src="https://image.youyou-2608.com/springboot/tomcat.png"></p>
<ol>
<li>如何定制嵌入式的Servlet容器？</li>
<li>SpringBoot能否支持其他的Servlet容器？</li>
</ol>
<ol>
<li>修改和Server有关的配置(server.properties)：</li>
</ol>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="meta">servet.context-path</span>=<span class="string">/path</span></span><br></pre></td></tr></table></figure>



<ol>
<li><p><strong>编写一个EmbeddedServletContainerCustomizer来修改嵌入式Servlet容器：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title">embeddedServletContainerCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> </span>&#123;</span><br><span class="line">        container.setPort(<span class="number">8083</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>与容器相关的类：ServerProperties.class</p>
<p>SpringBoot2.0：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedTomcatConfig</span> <span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">ConfigurableServletWebServerFactory</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableServletWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">        factory.setContextPath(<span class="string">&quot;/test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<hr>
<h3 id="5-2-注册Servlet容器三大组件"><a href="#5-2-注册Servlet容器三大组件" class="headerlink" title="5.2 注册Servlet容器三大组件"></a>5.2 注册Servlet容器三大组件</h3><p>Servlet：ServletRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean&lt;MyServlet&gt; <span class="title">myServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> MyServlet(), <span class="string">&quot;/servlet.do&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Filter：FilterRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean&lt;MyFilter&gt; <span class="title">myFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean&lt;MyFilter&gt; registrationBean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> MyFilter());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/hello.do&quot;</span>, <span class="string">&quot;/nihao.do&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Listener：ServletListenerRegistrationBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean&lt;MyListener&gt; <span class="title">myListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> ServletListenerRegistrationBean&lt;MyListener&gt;();</span><br><span class="line">    registrationBean.setListener(<span class="keyword">new</span> MyListener());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="5-3-嵌入式Servlet容器自动配置原理"><a href="#5-3-嵌入式Servlet容器自动配置原理" class="headerlink" title="5.3 嵌入式Servlet容器自动配置原理"></a>5.3 嵌入式Servlet容器自动配置原理</h3><p>EmbeddedWebServerFactoryCustomizerAutoConfiguration.class</p>
<p>Tomcat：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Tomcat.class, UpgradeProtocol.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TomcatWebServerFactoryCustomizerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TomcatWebServerFactoryCustomizer <span class="title">tomcatWebServerFactoryCustomizer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        Environment environment, ServerProperties serverProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TomcatWebServerFactoryCustomizer(environment, serverProperties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Jetty：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Server.class, Loader.class, WebAppContext.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JettyWebServerFactoryCustomizerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JettyWebServerFactoryCustomizer <span class="title">jettyWebServerFactoryCustomizer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        Environment environment, ServerProperties serverProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JettyWebServerFactoryCustomizer(environment, serverProperties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Undertow：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Undertow.class, SslClientAuthMode.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UndertowWebServerFactoryCustomizerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UndertowWebServerFactoryCustomizer <span class="title">undertowWebServerFactoryCustomizer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        Environment environment, ServerProperties serverProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UndertowWebServerFactoryCustomizer(environment, serverProperties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>配置文件：Server.properties：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;server&quot;, ignoreUnknownFields = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerProperties</span> </span>&#123;</span><br></pre></td></tr></table></figure>



<p>ConfigurableTomcatWebServerFactory.class：</p>
<p><img src="https://image.youyou-2608.com/springboot/hy.png"></p>
<hr>
<h3 id="5-4-使用外置的Servlet容器"><a href="#5-4-使用外置的Servlet容器" class="headerlink" title="5.4 使用外置的Servlet容器"></a>5.4 使用外置的Servlet容器</h3><p>内置的servlet容器不支持jsp；</p>
<ol>
<li>向项目中导入tomcat服务器，创建web.xml文件，添加application.properties配置；打包方式为war包；</li>
</ol>
<p>必须编写一个ServletInitializer文件；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletInitializer</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources($&#123;MainClass&#125;.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>将嵌入式spring-boot-start-web内嵌的tomcat的scope指定为provided；</li>
</ol>
<hr>
<h2 id="第六章-Docker技术"><a href="#第六章-Docker技术" class="headerlink" title="第六章 Docker技术"></a>第六章 Docker技术</h2><h3 id="6-1-docker简介"><a href="#6-1-docker简介" class="headerlink" title="6.1 docker简介"></a>6.1 docker简介</h3><p>概念：Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、<a target="_blank" rel="noopener" href="http://www.whatis.com.cn/word_5275.htm">bare metal</a>、OpenStack 集群和其他的基础应用平台。 </p>
<p><a target="_blank" rel="noopener" href="http://www.docker.org.cn/book/docker/what-is-docker-16.html">Docker入门</a></p>
<p><img src="https://image.youyou-2608.com/springboot/image_docker.png"></p>
<hr>
<h3 id="6-2-Docker核心概念"><a href="#6-2-Docker核心概念" class="headerlink" title="6.2 Docker核心概念"></a>6.2 Docker核心概念</h3><ol>
<li>docker主机(Host)：安装了Docker程序的机器(Docker直接安装在操作系统之上)；</li>
<li>docker客户端(Client)：连接Docker主机进行操作；</li>
<li>docker仓库(Registry)：用来保存各种打包好的软件镜像；</li>
<li>docker镜像(Images)：软件打包好的镜像，放在docker仓库中；</li>
<li>docker容器(Container)：镜像启动后的实例称为一个容器，容器是独立运行的一个或一组应用；</li>
</ol>
<p>使用docker容器的步骤：</p>
<ol>
<li>安装docker；</li>
<li>去docker仓库找到这个软件对应的镜像；</li>
<li>使用docker运行这个镜像，就会生成一个Docker镜像容器；</li>
<li>对容器的启动和停止就是对软件的启动和停止。</li>
</ol>
<hr>
<h3 id="6-3-Docker常用操作"><a href="#6-3-Docker常用操作" class="headerlink" title="6.3 Docker常用操作"></a>6.3 Docker常用操作</h3><p>镜像官方网站：<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker search mysql     //搜索镜像</span><br><span class="line">docker pull mysql:5.5   //拉取镜像</span><br><span class="line">docker images           //查看本地所有镜像</span><br><span class="line">docker rmi images-id    //删除本地镜像</span><br></pre></td></tr></table></figure>

<p><img src="https://image.youyou-2608.com/springboot/docker_run.png"></p>
<p><strong>各个独立的容器互不干扰，独立运行。</strong></p>
<hr>
<h3 id="6-4-环境搭建"><a href="#6-4-环境搭建" class="headerlink" title="6.4 环境搭建"></a>6.4 环境搭建</h3><h4 id="6-4-1-安装MySQL："><a href="#6-4-1-安装MySQL：" class="headerlink" title="6.4.1 安装MySQL："></a>6.4.1 安装MySQL：</h4><p>启动一个MySQL实例(需要指定密码和<strong>端口映射</strong>)：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -p port --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br></pre></td></tr></table></figure>

<p>官方文档：<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql/">MySQL文档</a></p>
<p>几个高级操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">使用配置文件：</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"></span><br><span class="line">不适用配置文件：</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span></span><br></pre></td></tr></table></figure>



<h4 id="6-4-2-安装Redis"><a href="#6-4-2-安装Redis" class="headerlink" title="6.4.2 安装Redis"></a>6.4.2 安装Redis</h4><h4 id="6-4-3-安装RabbitMQ"><a href="#6-4-3-安装RabbitMQ" class="headerlink" title="6.4.3 安装RabbitMQ"></a>6.4.3 安装RabbitMQ</h4><h4 id="6-4-4-安装ElasticSearch"><a href="#6-4-4-安装ElasticSearch" class="headerlink" title="6.4.4 安装ElasticSearch"></a>6.4.4 安装ElasticSearch</h4><hr>
<h2 id="第七章-SpringBoot与数据库访问"><a href="#第七章-SpringBoot与数据库访问" class="headerlink" title="第七章 SpringBoot与数据库访问"></a>第七章 SpringBoot与数据库访问</h2><p>SpringBoot与数据访问相关的场景启动器：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">spring-boot-starter-data-cassandra</span><br><span class="line"></span><br><span class="line">Starter for using Cassandra distributed database and Spring Data Cassandra</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-cassandra-reactive</span><br><span class="line"></span><br><span class="line">Starter for using Cassandra distributed database and Spring Data Cassandra Reactive</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-couchbase</span><br><span class="line"></span><br><span class="line">Starter for using Couchbase document-oriented database and Spring Data Couchbase</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-couchbase-reactive</span><br><span class="line"></span><br><span class="line">Starter for using Couchbase document-oriented database and Spring Data Couchbase Reactive</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-elasticsearch</span><br><span class="line"></span><br><span class="line">Starter for using Elasticsearch search and analytics engine and Spring Data Elasticsearch</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-jpa</span><br><span class="line"></span><br><span class="line">Starter for using Spring Data JPA with Hibernate</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-ldap</span><br><span class="line"></span><br><span class="line">Starter for using Spring Data LDAP</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-mongodb</span><br><span class="line"></span><br><span class="line">Starter for using MongoDB document-oriented database and Spring Data MongoDB</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-mongodb-reactive</span><br><span class="line"></span><br><span class="line">Starter for using MongoDB document-oriented database and Spring Data MongoDB Reactive</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-neo4j</span><br><span class="line"></span><br><span class="line">Starter for using Neo4j graph database and Spring Data Neo4j</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-redis</span><br><span class="line"></span><br><span class="line">Starter for using Redis key-value data store with Spring Data Redis and the Lettuce client</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-redis-reactive</span><br><span class="line"></span><br><span class="line">Starter for using Redis key-value data store with Spring Data Redis reactive and the Lettuce client</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-rest</span><br><span class="line"></span><br><span class="line">Starter for exposing Spring Data repositories over REST using Spring Data REST</span><br><span class="line"></span><br><span class="line">Pom</span><br><span class="line"></span><br><span class="line">spring-boot-starter-data-solr</span><br><span class="line"></span><br><span class="line">Starter for using the Apache Solr search platform with Spring Data Solr</span><br><span class="line"></span><br><span class="line">Pom</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="7-1-整合JDBC与数据源"><a href="#7-1-整合JDBC与数据源" class="headerlink" title="7.1 整合JDBC与数据源"></a>7.1 整合JDBC与数据源</h3><p>建表语句执行：classpath:schema-*.sql</p>
<p>数据操作语句：classpath:data-*.sql</p>
<p>也可以使用schema在application.yml中自定义数据文件地址。</p>
<hr>
<h3 id="7-2-Druid数据源配置"><a href="#7-2-Druid数据源配置" class="headerlink" title="7.2 Druid数据源配置"></a>7.2 Druid数据源配置</h3><ol>
<li>引入依赖；</li>
<li>配置属性。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">type指定数据源</span><br></pre></td></tr></table></figure>



<p>添加一个配置类，将Druid配置映射到数据源。</p>
<p>结合过滤器和Servlet设置Druid监控。</p>
<hr>
<h3 id="7-3-整合MyBatis"><a href="#7-3-整合MyBatis" class="headerlink" title="7.3 整合MyBatis"></a>7.3 整合MyBatis</h3><p>启动器：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">mybatis-spring-boot-starter</span><br></pre></td></tr></table></figure>

<p>获取插入数据库的记录的ID：</p>
<p>@Options(userGeneratedKeys=, keyProperty=）</p>
<p>开启MyBatis驼峰命名：</p>
<p>写一个配置类，实现ConfigurationCustomizer接口中的customize()方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">configuration.setMapUnderscopeToCamelCase(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>



<p>批量扫描所有的@Mapper注解：</p>
<p>@MapperScan(value=””)</p>
<p>相关配置文件见官网文档。</p>
<p>全局配置文件配置：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">mybatis-config-location</span>:<span class="string">classpath:mybatis/config.xml</span></span><br><span class="line"><span class="meta">mybatis-config-mapper</span>:<span class="string">class:mybatis/mapper.xml</span></span><br></pre></td></tr></table></figure>







<hr>
<h3 id="7-4-SpringData数据访问JPA"><a href="#7-4-SpringData数据访问JPA" class="headerlink" title="7.4 SpringData数据访问JPA"></a>7.4 SpringData数据访问JPA</h3>
                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/01/03/LeetCode之3Sum/" data-toggle="tooltip" data-placement="top"
                           title="LeetCode之3Sum">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2018/12/02/深田恭子的日剧跑/" data-toggle="tooltip" data-placement="top"
                           title="深田恭子的日剧跑">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                


                <!--加入新的评论系统-->
                

                
            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <h3 style="border-left: none; margin-top: 10px;">
                        <!--  
                            SpringBoot基础学习笔..
                           -->
                        SpringBoot基础学..
                    </h3>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81"><span class="toc-text">内容概要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-SpringBoot%E5%85%A5%E9%97%A8"><span class="toc-text">第一章 SpringBoot入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-SpringBoot%E7%AE%80%E4%BB%8B"><span class="toc-text">1.1 SpringBoot简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.2 微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">1.3 开发环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%EF%BC%9AHelloWorld"><span class="toc-text">1.4 第一个应用：HelloWorld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-HelloWorld%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6"><span class="toc-text">1.5 HelloWorld原理探究</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E4%B8%BB%E7%A8%8B%E5%BA%8F%E7%B1%BB%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6"><span class="toc-text">1.6 主程序类原理探究</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-SpringBoot%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%99%A8"><span class="toc-text">1.7 SpringBoot项目初始化器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-SpringBoot%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">第二章 SpringBoot配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-SpringBoot%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 SpringBoot配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-YAML%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">2.2 YAML基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-text">2.2.1配置文件注入：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-Value%E6%B3%A8%E5%85%A5%E5%80%BC"><span class="toc-text">2.2.2 @Value注入值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-Value%E5%92%8C-ConfigurationProperties%E8%8E%B7%E5%8F%96%E5%80%BC%E6%AF%94%E8%BE%83%EF%BC%9A"><span class="toc-text">2.2.3 @Value和@ConfigurationProperties获取值比较：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-Value%E5%92%8C-ConfigurationProperties%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-text">2.2.4 @Value和@ConfigurationProperties的比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-PropertySource%E5%92%8C-ImportSource"><span class="toc-text">2.3 @PropertySource和@ImportSource</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-PropertySource%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%80%BC%EF%BC%9A"><span class="toc-text">2.3.1 @PropertySource获取配置文件的值：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-ImportSource%EF%BC%9A%E5%AF%BC%E5%85%A5Spring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E6%98%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88%E3%80%82"><span class="toc-text">2.3.2 @ImportSource：导入Spring配置文件，是配置文件中的配置生效。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-SpringBoot%E6%8E%A8%E8%8D%90%E7%9A%84%E6%B7%BB%E5%8A%A0%E7%BB%84%E4%BB%B6%E6%96%B9%E5%BC%8F"><span class="toc-text">2.3.3 SpringBoot推荐的添加组件方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-text">2.4 配置文件占位符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Profile%E5%A4%9A%E7%8E%AF%E5%A2%83%E6%94%AF%E6%8C%81"><span class="toc-text">2.5 Profile多环境支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E4%BD%8D%E7%BD%AE"><span class="toc-text">2.6 配置文件加载位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="toc-text">2.7 外部配置文件加载顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">2.8 自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-Conditional%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">2.9 @Conditional自动配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-SpringBoot%E4%B8%8E%E6%97%A5%E5%BF%97"><span class="toc-text">第三章 SpringBoot与日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-text">3.1 日志框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-SLF4J%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3.2 SLF4J的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%A6%82%E4%BD%95%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8SLF4J"><span class="toc-text">3.2.1 如何在系统中使用SLF4J</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E9%81%97%E7%95%99%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.2 遗留问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SpringBoot%E6%97%A5%E5%BF%97%E5%85%B3%E7%B3%BB"><span class="toc-text">3.3 SpringBoot日志关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-SpringBoot%E9%BB%98%E8%AE%A4%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-text">3.4 SpringBoot默认日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%8C%87%E5%AE%9A%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%92%8C%E6%97%A5%E5%BF%97profile%E5%8A%9F%E8%83%BD"><span class="toc-text">3.5 指定日志文件和日志profile功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="toc-text">3.6 切换日志框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-SpringBoot%E4%B8%8EWeb%E5%BC%80%E5%8F%91"><span class="toc-text">第四章 SpringBoot与Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-webjar%E4%B8%8E%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-text">4.1 webjar与静态资源映射规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%BC%95%E5%85%A5Thymeleaf%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-text">4.2 引入Thymeleaf模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Thymeleaf%E8%AF%AD%E6%B3%95"><span class="toc-text">4.3 Thymeleaf语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8A%9F%E8%83%BD"><span class="toc-text">4.4 SpringMVC自动配置功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">4.4.1 SpringMVC自动配置项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E6%89%A9%E5%B1%95SpringMVC%E9%85%8D%E7%BD%AE"><span class="toc-text">4.4.2 扩展SpringMVC配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1SpringMVC"><span class="toc-text">4.4.3 全面接管SpringMVC</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%BC%95%E5%85%A5%E8%B5%84%E6%BA%90"><span class="toc-text">4.5 引入资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-text">4.6 国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">4.7 拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-CRUD%E5%AE%9E%E9%AA%8C"><span class="toc-text">4.8 CRUD实验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-1-%E5%AE%9E%E9%AA%8C%E8%A6%81%E6%B1%82"><span class="toc-text">4.8.1 实验要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-2-%E5%85%AC%E5%85%B1%E9%A1%B5%E9%9D%A2%E6%8A%BD%E5%8F%96%E2%80%94%E5%88%97%E8%A1%A8%E9%A1%B5"><span class="toc-text">4.8.2 公共页面抽取—列表页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-3-%E9%93%BE%E6%8E%A5%E9%AB%98%E4%BA%AE-amp-%E5%88%97%E8%A1%A8%E5%AE%8C%E6%88%90"><span class="toc-text">4.8.3 链接高亮&amp;列表完成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-4-%E6%B7%BB%E5%8A%A0%E5%91%98%E5%B7%A5-gt-%E6%9D%A5%E5%88%B0%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2"><span class="toc-text">4.8.4 添加员工 &gt; 来到添加页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-5-%E6%B7%BB%E5%8A%A0%E5%91%98%E5%B7%A5-gt-%E5%AE%8C%E6%88%90%E6%B7%BB%E5%8A%A0"><span class="toc-text">4.8.5 添加员工 &gt; 完成添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-6-%E4%BF%AE%E6%94%B9%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-text">4.8.6 修改员工信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-7-%E5%88%A0%E9%99%A4%E5%91%98%E5%B7%A5"><span class="toc-text">4.8.7 删除员工</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="toc-text">4.9 定制错误页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-text">第五章 配置嵌入式Servlet容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%AE%9A%E5%88%B6%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-text">5.1 定制嵌入式Servlet容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%B3%A8%E5%86%8CServlet%E5%AE%B9%E5%99%A8%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6"><span class="toc-text">5.2 注册Servlet容器三大组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">5.3 嵌入式Servlet容器自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E4%BD%BF%E7%94%A8%E5%A4%96%E7%BD%AE%E7%9A%84Servlet%E5%AE%B9%E5%99%A8"><span class="toc-text">5.4 使用外置的Servlet容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-Docker%E6%8A%80%E6%9C%AF"><span class="toc-text">第六章 Docker技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-docker%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1 docker简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">6.2 Docker核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">6.3 Docker常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">6.4 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-%E5%AE%89%E8%A3%85MySQL%EF%BC%9A"><span class="toc-text">6.4.1 安装MySQL：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-%E5%AE%89%E8%A3%85Redis"><span class="toc-text">6.4.2 安装Redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-3-%E5%AE%89%E8%A3%85RabbitMQ"><span class="toc-text">6.4.3 安装RabbitMQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-4-%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-text">6.4.4 安装ElasticSearch</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE"><span class="toc-text">第七章 SpringBoot与数据库访问</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E6%95%B4%E5%90%88JDBC%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">7.1 整合JDBC与数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-Druid%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-text">7.2 Druid数据源配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%95%B4%E5%90%88MyBatis"><span class="toc-text">7.3 整合MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-SpringData%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AEJPA"><span class="toc-text">7.4 SpringData数据访问JPA</span></a></li></ol></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                <!-- 
                <section>
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#SpringBoot"
                           title="SpringBoot">SpringBoot</a>
                        
                    </div>
                </section>
                 -->

                <!-- Friends Blog -->
                <!-- 
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a target="_blank" rel="noopener" href="https://baidu.com">Kaijun&#39;s Blog</a></li>
                        
                        <li><a target="_blank" rel="noopener" href="https://baidu.com">Hux Blog</a></li>
                        
                        <li><a target="_blank" rel="noopener" href="https://baidu.com">Hux Blog</a></li>
                        
                        <li><a target="_blank" rel="noopener" href="https://baidu.com">Hux Blog</a></li>
                        
                        <li><a target="_blank" rel="noopener" href="https://baidu.com">Hux Blog</a></li>
                        
                    </ul>
                </div>
                 -->
            </div>
        </div>

    </div>
</article>







<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Chenxii 2018-2021
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Themed by <a target="_blank" rel="noopener" href="https://github.com/chenxii81/hexo-theme-anisina">Chenxii81</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/blog.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://iced-cola.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>



<!-- Google Analytics -->



<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','','2.0.0');
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="">
</body>

</html>
